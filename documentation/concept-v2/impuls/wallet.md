# â— IMPULS â€“ Wallet

> **Schicht:** 4 â€“ Handlung
> **SphÃ¤re:** ECHO (Swarm-Modul)
> **Typ:** VermÃ¶gensverwaltung

---

## Konzept

Das **Wallet** ist der VermÃ¶gensspeicher eines Agenten. Es verwaltet Guthaben, Zahlungsmethoden und Budget-Limits.

---

## Wallet-Architektur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   AGENT WALLET                                                             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   ğŸ¤– Agent: did:erynoa:agent:seeker:vehicle-123                    â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚   â”‚   â”‚                                                           â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   ğŸ’° WALLET                                               â”‚    â”‚  â”‚
â”‚   â”‚   â”‚                                                           â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ Balances                                        â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ â•â•â•â•â•â•â•â•                                        â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ EUR:    50.00                                   â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ USDC:   25.00                                   â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ IOTA:   100.00                                  â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚                                                           â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ Payment Methods                                 â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                 â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ ğŸ’³ Visa ****4242 (delegiert von Owner)         â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ ğŸ¦ SEPA DE89...  (delegiert von Owner)         â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ ğŸ”— USDC-Wallet 0x1234... (eigen)               â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚                                                           â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ Limits (from Policy)                            â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ â•â•â•â•â•â•                                          â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ Per Transaction: 50.00 EUR                      â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ Per Day:        100.00 EUR (spent: 35.00)       â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â”‚ Per Month:      500.00 EUR (spent: 120.00)      â”‚    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚  â”‚
â”‚   â”‚   â”‚                                                           â”‚    â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Wallet-Definition

```yaml
wallet {
  id:    "did:erynoa:wallet:agent-123"
  owner: @identity("did:erynoa:agent:seeker:vehicle-123")

  # Guthaben
  balances: {
    EUR:  { amount: 50.00,  source: "topup" }
    USDC: { amount: 25.00,  source: "crypto" }
    IOTA: { amount: 100.00, source: "streaming" }
  }

  # Zahlungsmethoden
  payment_methods: [
    {
      type:       credit_card
      provider:   visa
      last_four:  "4242"
      delegated:  true
      delegator:  @identity("did:erynoa:person:alice")
    },
    {
      type:       crypto
      currency:   USDC
      address:    "0x1234..."
      delegated:  false
    }
  ]

  # Limits (Ã¼berschreiben Policy-Defaults)
  limits: {
    per_transaction: 50.00
    per_day:         100.00
    per_month:       500.00
  }

  # Aktueller Verbrauch
  spent: {
    today:     35.00
    this_week: 120.00
    this_month: 180.00
  }
}
```

---

## Wallet-Operationen

### Top-Up (Aufladen)

```yaml
wallet topup {
  wallet: @ref("did:erynoa:wallet:agent-123")

  amount:   50.00
  currency: EUR

  source: {
    type:   credit_card
    method: @ref("did:erynoa:credential:payment:cc-visa")
  }

  # Erfordert Owner-Signatur
  authorized_by: @identity("did:erynoa:person:alice")
}
```

### Payment (Zahlung)

```yaml
wallet pay {
  wallet: @ref("did:erynoa:wallet:agent-123")

  amount:   21.50
  currency: EUR

  recipient: @identity("did:erynoa:agent:provider:swm")
  reason:    @ref("did:erynoa:agreement:charging-2025-001")

  # Automatisch durch Agent (innerhalb Policy-Limits)
  authorized_by: @identity("did:erynoa:agent:seeker:vehicle-123")
}
```

---

## Streaming Payments

FÃ¼r zeitbasierte Dienste (z.B. Laden):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚   VALUE STREAMING                                                          â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   Ladevorgang: 30 Minuten, 0.42 â‚¬/kWh, ~50 kWh                     â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   Statt: Einmalzahlung 21.00â‚¬ am Ende                              â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   Streaming: Kontinuierlicher Werttransfer                         â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                           â”‚  â”‚
â”‚   â”‚   â”‚ 5m  â”‚ 10m â”‚ 15m â”‚ 20m â”‚ 25m â”‚ 30m â”‚                           â”‚  â”‚
â”‚   â”‚   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                           â”‚  â”‚
â”‚   â”‚   â”‚3.50â‚¬â”‚3.50â‚¬â”‚3.50â‚¬â”‚3.50â‚¬â”‚3.50â‚¬â”‚3.50â‚¬â”‚  = 21.00â‚¬                 â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                           â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â”‚   Vorteile:                                                        â”‚  â”‚
â”‚   â”‚   â€¢ Kein Vorschuss nÃ¶tig                                          â”‚  â”‚
â”‚   â”‚   â€¢ Abbruch jederzeit mÃ¶glich                                      â”‚  â”‚
â”‚   â”‚   â€¢ Provider hat kontinuierliche Sicherheit                        â”‚  â”‚
â”‚   â”‚                                                                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Streaming-Definition

```yaml
payment_stream {
  id: "did:erynoa:stream:charging-001"

  # Parteien
  sender:   @ref("did:erynoa:wallet:agent-123")
  receiver: @ref("did:erynoa:wallet:provider-swm")

  # Rate
  rate: {
    amount:   0.42    # EUR
    per:      "kWh"   # Einheit
  }

  # Alternativ: zeitbasiert
  # rate: {
  #   amount: 0.01  # EUR
  #   per:    "second"
  # }

  # Limits
  max_amount: 30.00

  # Referenz
  agreement: @ref("did:erynoa:agreement:charging-2025-001")

  # Status
  status: active
  started_at: "2025-01-28T10:20:00Z"
  transferred: 14.50  # Bisher
}
```

---

## WeiterfÃ¼hrende Dokumente

- [agent-modell.md](./agent-modell.md) â€“ Agenten
- [policy.md](./policy.md) â€“ Budget-Limits
- [../chronik/streaming.md](../chronik/streaming.md) â€“ Streaming-Finalisierung
